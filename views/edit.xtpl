<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>编辑页面</title>
  <style>
   h1 {
     text-align: center;
   }

   .width-1180 {
     width: 1180px;
     margin: 0 auto;
   }

   .line {
     display: block;
     overflow: hidden;
     margin-bottom: 20px;
     height: 28px;
   }
   
   .line.more-line {
     height: auto;
   }

   .line .title {
     float: left;
     width: 200px;
     text-align: right;
   }

   .line select {
     width: 150px;
     height: 28px;
     outline: none;
     border: 1px solid #dfdfdf;
     border-radius: 5px;
   }

   .line .ipt {
     width: 150px;
     height: 24px;
     border-radius: 4px;
     border: 1px solid #dfdfdf;
     outline: none;
     text-indent: 5px;
   }
   .img-list {
     overflow: hidden;
     padding: 0 100px;
   }

   .img-list .u-img {
    float: left;
    margin: 0 10px 10px 0;
    text-align: center;
   }

   .img-list .u-img img {
     width: 100px;
     height: 100px;
     display: block;
   }

  </style>
  <script src="/js/jquery-1.11.1.min.js"></script>
  <script type="text/javascript" charset="utf-8" src="/ueditor/ueditor.config.js"></script>
  <script type="text/javascript" charset="utf-8" src="/ueditor/ueditor.all.min.js"> </script>
  <script type="text/javascript" charset="utf-8" src="/ueditor/lang/zh-cn/zh-cn.js"> </script>
</head>
<body>
  <div class="width-1180">
    <h1>编辑产品列表&nbsp;&nbsp;{{pid}}</h1>
    <label class="line">
      <span class="title">选择类别：</span>
      <div class="right-content">
        <select id="item-type">
          <option value="Outdoor">Outdoor</option>
          <option value="Indoor">Indoor</option>
          <option value="Pets">Pets</option>
          <option value="Storage">Storage</option>
        </select>
      </div>
    </label>
    <label class="line">
      <span class="title">名称：</span>
      <div class="right-content">
        <input class="ipt" type="text" id="ipt-name" value="">
      </div>
    </label>
    <label class="line">
      <span class="title">价格：</span>
      <div class="right-content">
        <input class="ipt" type="text" id="ipt-price" value="">
      </div>
    </label>
    <label class="line">
      <span class="title">选择图片：</span>
      <div class="right-content">
        <input id="uploadfile" type="file" multiple="multiple" style="width:200px">
        <button id="uploadsure" type="button">确认上传</button>&nbsp;<span style="color:orangered">选择文件之后需要点击确认上传来完成文件上传</span>
      </div>
    </label>
    <div class="img-list">
      <!--<div class="u-img">
        <img src="/img/home/outdoor/p1.jpg" alt="">
        <input name="img" type="radio">
      </div>
      <div class="u-img">
        <img src="/img/home/outdoor/p2.jpg" alt="">
        <input name="img" type="radio">
      </div>
      <div class="u-img">
        <img src="/img/home/outdoor/p3.jpg" alt="">
        <input name="img" type="radio">
      </div>-->
    </div>
    <label class="line more-line">
      <span class="title">商品属性：</span>
      <script id="editor-attribute" type="text/plain" style="width:800px;height:400px;float:left"></script>
    </label>
    <label class="line more-line">
      <span class="title">商品描述：</span>
      <script id="editor-description" type="text/plain" style="width:800px;height:400px;float:left"></script>
    </label>
    <div class="btn-box" style="text-align:center;">
      <button id="btn-submit">提交</button>
    </div>
  </div>
</body>
<script>
  var ueAttribute = UE.getEditor('editor-attribute');
  var ueDesc = UE.getEditor('editor-description');
</script>
<script>
  $(function(){
    //上传文件 $('.u-img input[name="img"]:checked').siblings('img')
    $('#uploadsure').click(function(){
      console.log('确认');
      var file = document.getElementById('uploadfile').files;
      console.log(file.length);
      if(file.length == 0){
        return;
      }
      //新建一个FormData对象
      var formData = new FormData();
      //追加文件数据
      for(var i = 0; i < file.length; i++){
        formData.append('files',file[i]);
      }
      $.ajax({
        type: 'post',
        url: '/uploadfile',
        data: formData,
        processData: false,
        contentType: false,
        success:function(data){
          if(data.path.length){
            //成功上传的情况
            var html = '';
            data.path.forEach(function(path,index,array){
              html += '<div class="u-img">'+
                        '<img src="'+path.replace('public','')+'" >'+
                        '<input name="img" type="radio" '+(index==0?'checked':'')+' />'+
                      '</div>';
            });
            $('.img-list').append(html);
          }
        }
      });
    });

    //提交数据
    $('#btn-submit').click(function(){
      if($('#ipt-name').val() == ''){
        alert('请输入产品名称');
        return;
      }
      if($('#ipt-price').val() == ''){
        alert('请输入产品价格');
        return;
      }
      if(ueAttribute.getContent() == ''){
        alert('请输入产品属性');
        return;
      }
      if(ueDesc.getContent() == ''){
        alert('请输入产品描述');
        return;
      }
      //获取图片路径集合
      var imgurl = [];
      var saveData = {}; //待保存的数据
      saveData.itemType = $("#item-type option:selected").val(); //产品类别
      $('.u-img').each(function(i){
        var _this = $(this);
        imgurl.push(_this.find('img').attr('src'));
      });
      saveData.url = $('.u-img input[name="img"]:checked').siblings('img').attr('src') || ''; //列表图片
      saveData.name = $.trim($('#ipt-name').val()); //产品名称
      saveData.price = $.trim($('#ipt-price').val()); //产品价格
      saveData.imgList = imgurl; //详情页的图片集合
      saveData.attribute = ueAttribute.getContent();
      saveData.description = ueDesc.getContent();
      $.ajax({
        type: 'post',
        url: '/editsave',
        data: {
          params: JSON.stringify(saveData)
        },
        success:function(data){
          console.log(data);
        }
      })
    });
  })
</script>
</html>